<Window x:Class="ScanPlaneMaker.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ScanPlaneMaker"
        
       xmlns:wpftk="http://schemas.xceed.com/wpf/xaml/toolkit"
        
        mc:Ignorable="d"
Title="{Binding _title, UpdateSourceTrigger=PropertyChanged}" Height="900" Width="1050"
        Loaded="Window_Loaded" 
        Closing="Window_Closing"
        >

    <Grid ShowGridLines="False">
        <Grid.RowDefinitions>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="auto"/>
        </Grid.ColumnDefinitions>

        <!-- Configuration Port Série et Webcam -->
        <Grid Grid.Row="0" Grid.ColumnSpan="2" Margin="10,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="auto"/>
                <RowDefinition Height="auto"/>
                <RowDefinition Height="auto"/>
            </Grid.RowDefinitions>

            <!--Arduino-->
            <GroupBox Grid.Row="0" Grid.Column="0" Padding="5" Margin="0,0,10,0" >
                <GroupBox.Header>
                    <Label Content="Arduino" FontWeight="Bold" Foreground="CornflowerBlue" />
                </GroupBox.Header>
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Height="28" VerticalAlignment="Top">
                        <Label Content="Port :" VerticalAlignment="Center"/>
                        <ComboBox x:Name="comboBoxPorts" Width="100" Margin="5,0" VerticalContentAlignment="Center"/>
                        <Image Source="/Images/refresh.png" Height="25" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_COM_refresh_click"/>

                        <Grid Margin="5,0">
                            <Image x:Name="_img_arduino_connect" Visibility="Collapsed"  Source="/Images/device_connect.png" Height="25" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_Arduino_Disconnect_click"/>
                            <Image x:Name="_img_arduino_disconnect" Source="/Images/device_disconnect.png" Height="25" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_Arduino_Connect_click"/>
                        </Grid>
                    </StackPanel>
                </StackPanel>
            </GroupBox>

            <!--Camera-->
            <GroupBox Grid.Row="0" Grid.Column="1" Padding="5" Grid.RowSpan="2">
                <GroupBox.Header>
                    <Label Content="Camera" FontWeight="Bold" Foreground="CornflowerBlue" />
                </GroupBox.Header>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="auto"/>
                        <ColumnDefinition Width="auto"/>
                        <ColumnDefinition Width="auto"/>
                        <ColumnDefinition Width="auto"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="auto"/>
                        <RowDefinition Height="auto"/>
                        <RowDefinition Height="auto"/>
                    </Grid.RowDefinitions>

                    <Label Grid.Row="0" Grid.Column="0" Content="Device :" VerticalAlignment="Center"/>
                    <ComboBox Grid.Row="0" Grid.Column="1" x:Name="comboBoxCameras" Width="200" Margin="5,1" VerticalContentAlignment="Center" SelectionChanged="comboBoxCameras_SelectionChanged"/>
                    <Image Grid.Row="0" Grid.Column="2" Source="/Images/refresh.png" Height="25" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_webcam_refresh_click"/>

                    <Label Grid.Row="1" Grid.Column="0" Content="Resolution :" VerticalAlignment="Center"/>
                    <ComboBox Grid.Row="1" Grid.Column="1" x:Name="comboBoxResolutions" Width="200" Margin="5,1" VerticalContentAlignment="Center" SelectionChanged="comboBoxResolutions_SelectionChanged"/>

                    <Grid Grid.Row="0" Grid.Column="3" Margin="5,0">
                        <Image x:Name="_img_camera_connect" Source="/Images/toggle_off2.png" Width="25" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_Camera_Connect_click"/>
                        <Image x:Name="_img_camera_disconnect" Visibility="Collapsed"   Source="/Images/toggle_on2.png" Width="25" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_Camera_Disconnect_click"/>
                    </Grid>

                    <StackPanel Grid.Row="2" Orientation="Horizontal" Grid.ColumnSpan="3">
                        <Image Source="/Images/crop.png" Width="25" RenderOptions.BitmapScalingMode="Fant"
                               MouseDown="_btn_roi_click"/>
                        <Label x:Name="_lbl_roi" VerticalAlignment="Center"/>
                    </StackPanel>


                    <StackPanel Grid.Row="2" Orientation="Horizontal" Grid.ColumnSpan="5" HorizontalAlignment="Right">
                        <Label Content="Take picture" />
                        <Image Source="/Images/camera.png" Height="25" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_Capture_click"/>
                    </StackPanel>
                </Grid>
            </GroupBox>

            <!--Folder-->
            <GroupBox Grid.Row="1" Padding="5" Margin="0,0,10,0" >
                <GroupBox.Header>
                    <Label Content="Folder" FontWeight="Bold" Foreground="CornflowerBlue" />
                </GroupBox.Header>

                <Grid Grid.Row="0" Margin="10,0,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Image Grid.Column="0"  Source="/Images/folder.png" Height="30" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_SelectFolder_Click"/>
                    <TextBox Grid.Column="1" x:Name="txtSavePath" TextWrapping="Wrap" VerticalAlignment="Center" Margin="5,0,0,0" 
                                       TextAlignment="Left" Text="{Binding _saveFolderPath, UpdateSourceTrigger=PropertyChanged}"/>
                </Grid>
            </GroupBox>

            <GroupBox Grid.Row="2" Grid.ColumnSpan="2" Padding="5" >
                <GroupBox.Header>
                    <Label Content="Scan" FontWeight="Bold" Foreground="CornflowerBlue" />
                </GroupBox.Header>

                <StackPanel Orientation="Horizontal">
                    <!--Move-->
                    <Grid Margin="2,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="auto"/>
                            <ColumnDefinition Width="auto"/>
                            <ColumnDefinition Width="auto"/>
                            <ColumnDefinition Width="auto"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="auto"/>
                            <RowDefinition Height="auto"/>
                            <RowDefinition Height="auto"/>
                            <RowDefinition Height="auto"/>
                        </Grid.RowDefinitions>
                        <Image Source="/Images/Fleche Bas.png" Grid.Column="1" Grid.Row="2" Height="30" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_move_down_click"/>
                        <Image Source="/Images/Fleche Gauche.png" Grid.Column="0" Grid.Row="1" Height="30" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_move_left_click"/>
                        <Image Source="/Images/Lecture.png" Grid.Column="2" Grid.Row="1" Height="30" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_move_right_click"/>
                        <Image Source="/Images/Fleche Haut.png" Grid.Column="1" Grid.Row="0" Height="30" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_move_up_click"/>

                        <!--<Button Grid.Column="1" Grid.Row="1" KeyDown="KeyDown_Pressed" Foreground="White"/>-->

                        <Image Source="/Images/Go_NE.png" Grid.Column="2" Grid.Row="0" Height="30" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_move_X_max_y_max_click"/>
                        <Image Source="/Images/Go_SO.png" Grid.Column="0" Grid.Row="2" Height="30" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_move_X_min_y_min_click"/>
                        <Image Source="/Images/Go_NO.png" Grid.Column="0" Grid.Row="0" Height="30" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_move_X_min_y_max_click"/> 
                        <Image Source="/Images/Go_SE.png" Grid.Column="2" Grid.Row="2" Height="30" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_move_X_max_y_min_click"/>

                        <StackPanel Grid.Column="3" Grid.Row="0" Orientation="Horizontal">
                            <Image Source="/Images/Upload.png" Margin="10,0,2,0" Height="30" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_move_Zplus_click"/>
                            <Image Source="/Images/Upload2.png" Margin="2,0,10,0" Height="30" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_move_Zplus2_click"/>
                        </StackPanel>

                        <StackPanel  Grid.Column="3" Grid.Row="2" Orientation="Horizontal">
                            <Image Source="/Images/Download.png" Margin="10,0,2,0"  Height="30" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_move_Zmoins_click"/>
                            <Image Source="/Images/Download2.png" Margin="2,0,10,0"  Height="30" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_move_Zmoins2_click"/>
                        </StackPanel>

                        <StackPanel Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="3" Height="25" Margin="5,0" Orientation="Horizontal" VerticalAlignment="Bottom">
                            <wpftk:DoubleUpDown Value="{Binding _xy_move_value, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" 
                                                Width="50" Minimum="0" Maximum="1000" FormatString="0.0" Margin="0,2" />
                            <Label Content="mm" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Grid>

                    <!--Goto-->
                    <StackPanel Orientation="Vertical" Margin="10,0">
                        <StackPanel Orientation="Horizontal">
                            <Label Content="Go to" FontWeight="Bold" VerticalAlignment="Center" />
                            <Image Source="/Images/goto.png" Height="25" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_goto_click"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal">
                            <Label Content="X:"/>
                            <wpftk:DoubleUpDown Value="{Binding _goto_x_value, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" 
                                                        Width="60" Minimum="0" Maximum="1000" FormatString="0.0" Margin="0,2" />
                            <Label Content="mm"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal">
                            <Label Content="Y:"/>
                            <wpftk:DoubleUpDown Value="{Binding _goto_y_value, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" 
                                                        Width="60" Minimum="0" Maximum="1000" FormatString="0.0" Margin="0,2" />
                            <Label Content="mm"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal">
                            <Image Source="/Images/magnifier.png" Height="25" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_get_position_click"/>
                            <Label Content="Get current position" VerticalAlignment="Center" />
                        </StackPanel>
                    </StackPanel>

                    <!--View Size-->
                    <StackPanel Orientation="Vertical" Margin="10,0">
                        <Label Content="View size" FontWeight="Bold"/>


                        <StackPanel Orientation="Horizontal">
                            <Label Content="Meas. (pix) :" VerticalAlignment="Center" />
                            <wpftk:DoubleUpDown Value="{Binding _measure_pix, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                                        Width="55" Minimum="0" Maximum="100" Increment="0.1" FormatString="0.0" Margin="7,2,0,2" />
                            <Image Source="/Images/metrique.png" Height="25" Margin="2,0" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_measure_on_image_click"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal">
                            <Label Content="Meas. (mm) :" VerticalAlignment="Center" Margin="0,0,0,0" />
                            <wpftk:DoubleUpDown Value="{Binding _measure_mm, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                                        Width="55" Minimum="0" Maximum="100" Increment="0.01" FormatString="0.00" Margin="2,2" />
                        </StackPanel>


                        <StackPanel Orientation="Horizontal">
                            <Label Content="Size (mm) :" VerticalAlignment="Center" Margin="0,0,10,0" />
                            <TextBlock Text="{Binding _range_computed, UpdateSourceTrigger=PropertyChanged, StringFormat=f2}" Width="30" VerticalAlignment="Center"/>
                            <Image Source="/Images/turn_down.png" Height="25" Margin="2,0" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_range_copy_compute_to_range_value_click"/>

                        </StackPanel>

                        <StackPanel Orientation="Horizontal">
                            <Label Content="Width (mm) :" VerticalAlignment="Center"/>
                            <wpftk:DoubleUpDown Value="{Binding _x_range_value, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                                        Width="55" Minimum="0" Maximum="100" Increment="0.01" FormatString="0.00" Margin="0,2,0,2" />
                        </StackPanel>


                        <StackPanel Orientation="Horizontal">
                            <Label Content="Height(mm) :" VerticalAlignment="Center"/>
                            <wpftk:DoubleUpDown Value="{Binding _y_range_value, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                                        Width="55" Minimum="0" Maximum="100" Increment="0.01" FormatString="0.00" Margin="0,2,0,2" />
                        </StackPanel>

                    </StackPanel>

                    <!--Scan Range-->
                    <StackPanel Orientation="Vertical" Margin="10,0">
                        <Label Content="Scan Range" FontWeight="Bold"/>

                        <StackPanel Orientation="Horizontal">
                            <Label Content="Start point (x,y)" VerticalAlignment="Center" Width="100"/>
                            <wpftk:DoubleUpDown Value="{Binding _scan_start_x_value, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" 
                                                        Width="60" Minimum="0" Maximum="1000" FormatString="0.0" Margin="0,2" />
                            <wpftk:DoubleUpDown Value="{Binding _scan_start_y_value, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" 
                                                        Width="60" Minimum="0" Maximum="1000" FormatString="0.0" Margin="0,2" />
                            <Image Margin="5,0" Source="/Images/record.png" Height="25" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_scan_set_start_click"/>
                            <Image Source="/Images/goto.png" Height="25" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_goto_start_click"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal">
                            <Label Content="End point (x,y)" VerticalAlignment="Center" Width="100"/>
                            <wpftk:DoubleUpDown Value="{Binding _scan_end_x_value, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" 
                                                        Width="60" Minimum="0" Maximum="1000" FormatString="0.0" Margin="0,2" />
                            <wpftk:DoubleUpDown Value="{Binding _scan_end_y_value, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" 
                                                        Width="60" Minimum="0" Maximum="1000" FormatString="0.0" Margin="0,2" />
                            <Image Margin="5,0" Source="/Images/record.png" Height="25" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_scan_set_end_click"/>
                            <Image Source="/Images/goto.png" Height="25" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_goto_end_click"/>

                        </StackPanel>
                    </StackPanel>

                    <!--Scan-->
                    <StackPanel Orientation="Horizontal" Margin="10,0" VerticalAlignment="Top">
                        <StackPanel Orientation="Vertical">
                            <Label Content="Scan" FontWeight="Bold" Width="40" HorizontalContentAlignment="Center" />
                            <Grid>
                                <Image x:Name="_img_scan_start" Source="/Images/matrice.png" Height="40" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_scan_start_click"/>
                                <Image x:Name="_img_scan_stop" Visibility="Collapsed" Source="/Images/Stop.png" Height="40" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_scan_stop_click"/>
                            </Grid>
                            <Label Content="{Binding _scan_progress, UpdateSourceTrigger=PropertyChanged}" HorizontalContentAlignment="Center" Height="40" />
                        </StackPanel>
                        <Border BorderBrush="Black" BorderThickness="1" Margin="5,-10">
                            <Image Source="{Binding _map_path, UpdateSourceTrigger=PropertyChanged}" 
                                   RenderOptions.BitmapScalingMode="Fant" Height="170" Width="170" RenderTransformOrigin="0.5,0.5">
                                <Image.RenderTransform>
                                    <TransformGroup>
                                        <ScaleTransform ScaleY="-1"/>
                                        <SkewTransform/>
                                        <RotateTransform/>
                                        <TranslateTransform/>
                                    </TransformGroup>
                                </Image.RenderTransform>
                            </Image>
                        </Border>
                    </StackPanel>

                </StackPanel>
            </GroupBox>
        </Grid>

        <Grid Grid.Row="1" Grid.Column="0" Margin="10,0,10,10">
            <Viewbox >
                <Grid >
                    <!-- Zone d'affichage Webcam -->
                    <Border BorderBrush="{Binding _brd_image_borderbrush}" BorderThickness="3"  >
                        <Image x:Name="imgWebcam" Stretch="Uniform" Source="{Binding _webcam}" />
                    </Border>

                </Grid>
            </Viewbox>

            <StackPanel Orientation="Vertical">
                <StackPanel Orientation="Horizontal">
                    <TextBlock  Background="#80FFFFFF" Text="Stability : " />
                    <TextBlock  Background="#80FFFFFF"
                                Text="{Binding _image_stability, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:F2}}"/>
                </StackPanel>
            </StackPanel>


            <StackPanel Orientation="Vertical">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <TextBlock  Background="#80FFFFFF" Text="X : " />
                    <TextBlock  Background="#80FFFFFF"
                           Text="{Binding _x, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:F1}}"/>
                    <TextBlock  Background="#80FFFFFF" Text="mm" />
                </StackPanel>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <TextBlock  Background="#80FFFFFF" Text="Y : " />
                    <TextBlock  Background="#80FFFFFF"
                           Text="{Binding _y, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:F1}}"/>
                    <TextBlock  Background="#80FFFFFF" Text="mm" />
                </StackPanel>
            </StackPanel>
        </Grid>

        <!-- Zone de contrôle et communication série -->
        <Grid Grid.Row="1" Grid.Column="1" Margin="0,0,10,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <GroupBox Width="400" Grid.Column="0">
                <GroupBox.Header>
                    <Label Content="Communication" FontWeight="Bold" Foreground="CornflowerBlue" />
                </GroupBox.Header>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="auto"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions >
                        <RowDefinition Height="auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBox Grid.Row="0" Grid.Column="0" x:Name="txtSendData" ToolTip="Data to send"
                             VerticalContentAlignment="Center" KeyDown="_txt_Send_KeyDown"/>

                    <Image Grid.Row="0" Grid.Column="1" Margin="5,0,0,0" Source="/Images/device_send_to_it.png" Height="30"
                         x:Name="_btn_Send" RenderOptions.BitmapScalingMode="Fant" MouseDown="_btn_Send_Click"/>


                    <TextBox Grid.Row="1" Grid.ColumnSpan="2" Margin="0,5,0,0" x:Name="txtReceivedData"
                             VerticalScrollBarVisibility="Auto" 
                             HorizontalScrollBarVisibility="Auto"
                             IsReadOnly="True" PreviewMouseRightButtonDown="_serial_text_right_click"
                             />
                </Grid>
            </GroupBox>

        </Grid>
    </Grid>
</Window>